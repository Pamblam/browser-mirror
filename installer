#!/usr/bin/env bash

HERE=$(pwd)
npm init -y
npm install browser-mirror
mv ./node_modules/browser-mirror/bm-server ./bm-server
chmod +x bm-server

PATH=$PATH:$HERE
export PATH

echo $HERE
echo $PATH

if [ -f ~/.profile ]; then
	printf '%s\n%s\n' '' "$(cat ~/.profile)" >~/.profile
	printf '%s%s%s\n%s\n' 'export PATH="$PATH:' $HERE '"' "$(cat ~/.profile)" >~/.profile
	printf '%s\n%s\n' '# Add bm-server to $PATH' "$(cat ~/.profile)" >~/.profile
	printf '%s\n%s\n' '' "$(cat ~/.profile)" >~/.profile
    source ~/.profile
fi

if [ -f ~/.bashrc ]; then
	printf '%s\n%s\n' '' "$(cat ~/.bashrc)" >~/.bashrc
	printf '%s%s%s\n%s\n' 'export PATH="$PATH:' $HERE '"' "$(cat ~/.bashrc)" >~/.bashrc
	printf '%s\n%s\n' '# Add bm-server to $PATH' "$(cat ~/.bashrc)" >~/.bashrc
	printf '%s\n%s\n' '' "$(cat ~/.bashrc)" >~/.bashrc
    source ~/.bashrc
fi

if [ -f ~/.bash_profile ]; then
	printf '%s\n%s\n' '' "$(cat ~/.bash_profile)" >~/.bash_profile
	printf '%s%s%s\n%s\n' 'export PATH="$PATH:' $HERE '"' "$(cat ~/.bash_profile)" >~/.bash_profile
	printf '%s\n%s\n' '# Add bm-server to $PATH' "$(cat ~/.bash_profile)" >~/.bash_profile
	printf '%s\n%s\n' '' "$(cat ~/.bash_profile)" >~/.bash_profile
    source ~/.bash_profile
fi

touch logs.txt && chmod 777 logs.txt

# testing...
# curl -L https://raw.githubusercontent.com/Pamblam/browser-mirror/dynamically-created-elements/installer | bash

# source /dev/stdin <<< "$(curl https://raw.githubusercontent.com/Pamblam/browser-mirror/dynamically-created-elements/installer?asd)"; echo done
